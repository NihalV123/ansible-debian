- name: clone oh my zsh
  run_once: true
  unarchive:
    src:  https://codeload.github.com/ohmyzsh/ohmyzsh/zip/master
    dest: /home/ec2_ansible/
    remote_src: yes


- name: check if zsh is installed
  stat:
    path: /home/ec2_ansible/.oh-my-zsh   
  register: o

- name: rename oh my zsh
  run_once: true
  shell: mv  /home/ec2_ansible/ohmyzsh-master /home/ec2_ansible/.oh-my-zsh
  when: not o.stat.exists

- name: Permissions for zsh
  file:
    path: /home/ec2_ansible/.oh-my-zsh
    state: directory
    owner: nnnn
    group: nnnn
    mode: '0755'

- name: clone power10k 
  run_once: true
  unarchive:
    src:  https://codeload.github.com/romkatv/powerlevel10k/zip/master
    dest: /home/ec2_ansible/.oh-my-zsh/themes/
    remote_src: yes

- name: check powerlevel10k directory present
  stat:
   path: /home/ec2_ansible/.oh-my-zsh/themes/powerlevel10k-master
  register: pow

- name: rename power10k
  run_once: true
  shell: mv /home/ec2_ansible/.oh-my-zsh/themes/powerlevel10k-master /home/ec2_ansible/.oh-my-zsh/themes/powerlevel10k
  when: not pow.stat.exists

- name: Creates zsh plugins directory
  run_once: true
  file:
    path: "{{ item }}"
    state: directory
    owner: nnnn
    group: nnnn
    mode: '0755'
  loop:
  - /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
  - /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-history-substring-search
  - /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-autosuggestions
  
- name: Creates zsh plugins directory
  run_once: true
  file:
    path: "{{ item }}"
    state: directory
    owner: nnnn
    group: nnnn
    mode: '0755'
  loop:
  - /home/nnnn/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
  - /home/nnnn/.oh-my-zsh/custom/plugins/zsh-history-substring-search
  - /home/nnnn/.oh-my-zsh/custom/plugins/zsh-autosuggestions  
  

- name: clone zsh syntax highlight
  run_once: true
  unarchive:
    src:  https://codeload.github.com/zsh-users/zsh-syntax-highlighting/zip/master
    dest: /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting/
    remote_src: yes

- name: clone zsh auto suggestions
  run_once: true
  unarchive:
    src:  https://codeload.github.com/zsh-users/zsh-autosuggestions/zip/master
    dest: /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-autosuggestions/
    remote_src: yes

- name: clone zsh history substring search
  run_once: true
  unarchive:
    src:  https://codeload.github.com/zsh-users/zsh-history-substring-search/zip/master
    dest: /home/ec2_ansible/.oh-my-zsh/custom/plugins/zsh-history-substring-search/
    remote_src: yes

- name: copy zsh to user
  run_once: true
  copy:
    src: "{{ item }}"
    dest: /home/ec2_ansible/
    owner: nnnn
    group: nnnn
    mode: '0755'
  loop:
  - files/lf
  - files/.p10k.zsh
  - files/.zshrc
  - files/notes

- name: Creates zsh cache directory
  run_once: true
  file:
    path: "{{ item }}"
    state: directory
    owner: nnnn
    group: nnnn
    mode: '0755' 
  loop:
  - /home/ec2_ansible/.oh-my-zsh/cache/
  - /home/ec2_ansible/.oh-my-zsh/cache/last-working-dir

- name: copy font to user
  run_once: true
  copy:
    src: "{{ item }}"
    dest: /home/ec2_ansible/.local/share/fonts/
    owner: nnnn
    group: nnnn
    mode: '0755'
  loop:
  - files/MesloLGS NF Regular.ttf

- name: check zsh systemwide present
  stat:
   path: /etc/skel/.oh-my-zsh
  register: z1

- name: copy zsh systemwide
  run_once: true
  shell: cp -r /home/ec2_ansible/.oh-my-zsh /etc/skel/
  when: not z1.stat.exists

- name: check zsh systemwide present
  stat:
   path: /etc/skel/.zshrc 
  register: z3
    
- name: copy zsh systemwide
  run_once: true
  shell: cp -r /home/ec2_ansible/.zshrc /etc/skel/ 
  when: not z3.stat.exists  

- name: check zsh systemwide present
  stat:
   path: /etc/skel/.p10k.zsh 
  register: z4
  
- name: copy zsh systemwide
  run_once: true
  shell: cp -r /home/ec2_ansible/.p10k.zsh /etc/skel/ 
  when: not z4.stat.exists  
  
- name: check zsh user present
  stat:
   path: /home/nnnn/.oh-my-zsh/themes
  register: z2

- name: copy zsh user
  run_once: true
  shell: cp -r /etc/skel/.oh-my-zsh /home/nnnn/
  when: not z2.stat.exists

- name: check zsh user present
  stat:
   path: /home/nnnn/.zshrc
  register: z5
    
- name: copy zsh user
  run_once: true
  shell: cp -r /etc/skel/.zshrc /home/nnnn/ 
  when: not z5.stat.exists  
  
- name: check zsh user present
  stat:
   path: /home/nnnn/.p10k.zsh 
  register: z6
    
- name: copy zsh  user
  run_once: true
  shell: cp -r /etc/skel/.p10k.zsh /home/nnnn/ 
  when: not z6.stat.exists    

- name: check powerlevel10k directory present
  stat:
   path: /home/nnnn/.oh-my-zsh/themes/powerlevel10k-master
  register: power

- name: rename power10k
  run_once: true
  shell: mv /home/ec2_ansible/.oh-my-zsh/themes/powerlevel10k-master /home/nnnn/.oh-my-zsh/themes/powerlevel10k
  when: not power.stat.exists


